@model IList<WageRateDetailResultSet>
@{

    var applicableYears = Model.Select(a => new
    {
        FinYear = a.FinYear,
        CPIIndex = a.CPIIndex,
        WageRate = a.PropertyValue
    }).GroupBy(a => new { a.CPIIndex, a.WageRate, a.FinYear })
            .Select(a => new
            {
                FinYear = a.Key.FinYear,
                CPIIndex = a.Key.CPIIndex,
                WageRate = a.Key.WageRate
            }).OrderBy(a=>a.FinYear);

    var grades = Model.Select(a => new
    {
        Ordinal = a.Ordinal,
        Grade = a.Grade,
        Group = a.OccupationGroup,
        Name = a.Occupation,
        Rate = a.Amount,
    })
    .GroupBy(a => new { a.Ordinal, a.Grade, a.Group, a.Name, a.Rate })
    .Select(a => new
    {
        Ordinal = a.Key.Ordinal,
        Grade = a.Key.Grade,
        Group = a.Key.Group,
        Name = a.Key.Name,
        Rate = a.Key.Rate
    })
     .GroupBy(a => new { a.Ordinal, a.Grade})
      .Select(a => new
      {
          Ordinal = a.Key.Ordinal,
          Grade = a.Key.Grade,
          GroupCount = a.Select(b => b.Group).Distinct().Count(),
          Count = a.Select(b => b.Name).Distinct().Count(),
          Average = a.Average(b=>b.Rate)
      })
    .OrderBy(a => a.Ordinal);


    var current = Model.FirstOrDefault();
    var latestYear = Model.Select(a => a.FinYear).OrderByDescending(a => a).FirstOrDefault();
    var iteration = 1;
    var background = "bg-success";
}
<div class="row">
    <div class="col-xl-6 col-md-12 col-lg-12">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="row">
                    <div class="col-xl-7 col-md-12 col-lg-6">
                        <div class="d-block card-header border-0 text-center px-0">
                            <h3 class="text-center mb-4">SWC  <b>Tracker!</b></h3>
                            @*<small>You reached Page Views</small>*@
                        </div>
                        <div class="row text-center">
                            <div class="col-md-12">
                                <h4 class="mb-0 fs-40 counter font-weight-bold">Construction Sector</h4>
                                <h6 class="mt-4 text-white-50">Sector Working Conditions Tracker</h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-5 col-md-12 col-lg-6">
                        <img class="mx-auto text-center w-90 analytics-img" src="~/images/logo_1.png">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-lg-6 col-md-12">
        <div class="card">
            <div class="card-body text-center">
                <span class="fs-50 icon-muted"><i class="si si-chart icon-dropshadow-info text-info"></i></span>
                <p class=" mb-1">Bounce Rate</p>
                <h2 class="mb-1 fs-40 font-weight-bold">52.12%</h2>
                <small class="mb-1 text-muted"><small class="text-success"><i class="fa fa-caret-up  me-1"></i> 19.8</small> vs 36,144 than last month</small>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-lg-6 col-md-12">
        <div class="card">
            <div class="card-body text-center">
                <span class="fs-50 icon-muted"><i class="si si-wallet icon-dropshadow-danger text-danger"></i></span>
                <p class=" mb-1 ">Revenue Status</p>
                <h2 class="mb-1 fs-40 font-weight-bold">$2,206.62</h2>
                <small class="mb-1 text-muted"><small class="text-danger"><i class="fa fa-caret-down  me-1"></i> 43.2</small> vs $5,699 than last month</small>
            </div>
        </div>
    </div>
    <div class="col-xl-12 col-md-12 col-lg-12">
        <div class="row">
            <div class="col-xl-5 col-lg-5 col-md-12">
                <div class="card">
                    <div class="row">
                        <div class="col-xl-12 col-md-12 col-lg-12">
                            <div class="card-header">
                                <h4 class="card-title">Wage Rate vs CPI Index</h4>
                            </div>
                            <div class="card-body text-center">
                                <div id="myfirstchart" class="BarChartShadow" style="height: 285px; -webkit-tap-highlight-color: transparent; user-select: none; position: relative; background: transparent;" _echarts_instance_="ec_1690462054282"><div style="position: relative; overflow: hidden; width: 528px; height: 285px; padding: 0px; margin: 0px; border-width: 0px; cursor: default;"><canvas width="528" height="285" data-zr-dom-id="zr_0" style="position: absolute; left: 0px; top: 0px; width: 528px; height: 285px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div style="position: absolute; display: block; border-style: solid; white-space: nowrap; z-index: 9; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s; background-color: rgba(50, 50, 50, 0.7); border-width: 0px; border-color: rgb(51, 51, 51); border-radius: 4px; color: rgb(255, 255, 255); font: 14px / 21px &quot;Microsoft YaHei&quot;; padding: 5px; left: 282px; top: 30px;">Jun<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:#4454c3;"></span>Page Views: 5,643<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:#f72d66;"></span>New Visitors: 4,534</div></div>
                                <div class="row mt-5">
                                    <div class="col text-center">
                                        <span class="text-muted float-end"><div class="w-3 h-3 bg-primary br-3 me-1 mt-1 float-start"></div> CPI Index</span>
                                    </div>
                                    <div class="col text-center">
                                        <span class="text-muted float-start"><div class="w-3 h-3 bg-secondary br-3 me-1 mt-1 float-start"></div> Wage Rate</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-12 col-lg-3">
                <div class="card overflow-hidden">
                    <div class="card-header mb-4">
                        <h3 class="card-title">Wage Rate vs CPI Index</h3>
                    </div>
                    <div class="countryscroll grid-wrapper invoice-table-responsive ps ps--active-y">
                        <table class="table card-table table-responsive small">
                            <thed>
                                <tr>
                                    <th class="col-1">Year</th>
                                    <th>Rate</th>
                                    <th class="col-1">CPI <br /> Index</th>
                                    <th></th>
                                </tr>
                            </thed>
                            <tbody>
                                @foreach (var item in applicableYears)
                                {
                                    var rateChange = item.WageRate - item.CPIIndex;
                                    <tr>
                                        <td>@item.FinYear</td>
                                        <td>
                                            @item.WageRate %
                                        </td>
                                        <td><span class="">@item.CPIIndex</span></td>
                                        <td>
                                            @if (rateChange >= 0)
                                        {
                                            <small class="mb-1 text-muted"><small class="text-success"><i class="fa fa-caret-up  me-1"></i> @rateChange %</small></small>
                                        }
                                        else
                                        {
                                                <small class="mb-1 text-muted"><small class="text-danger"><i class="fa fa-caret-down  me-1"></i>@rateChange %</small></small>
                                        }
                                        </td>
                                       
                                    </tr>
                                }

                            </tbody>
                        </table>
                    </div>
                    <div class="card-footer">
                        <a href="javascript:void(0)" class="btn btn-lg btn-block btn-white">View All</a>
                    </div>
                </div>
            </div>

            <div class="col-xl-4 col-lg-4 col-md-12">
                @{
                    @await Component.InvokeAsync("CalculatorPart", new { id =1 })
                }

            </div>

        </div>
    </div>
</div>

<div class="row row-deck">
    <div class="col-xl-8 col-lg-12 col-md-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Wage Rate By Grade</h3>
               
            </div>
            <div class="table-responsive card-body">
                <table class="table table-striped  mb-0 border">
                    <thead>
                        <tr>
                            <th class="wd-45p border-bottom-0 py-4 font-weight-bold">Grade</th>
                            <th class="border-bottom-0 py-4 font-weight-bold">Occupation Groups</th>
                            <th class="border-bottom-0 py-4 font-weight-bold">Occupations</th>
                            <th class="border-bottom-0 py-4 font-weight-bold">Wage Rate (per hour)</th>
                            <th class="border-bottom-0 py-4 font-weight-bold"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in grades)
                        {
                            <tr>
                                <td><strong>@item.Ordinal</strong></td>
                                <td><strong>@item.GroupCount</strong></td>
                                <td><strong>@item.Count</strong></td>
                                <td><strong>@item.Average.ToRandValue()</strong></td>
                                <td><a href="/Grade/Index/@item.Ordinal" class="btn btn-primary btn-sm">view more</a></td>
                            </tr>
                        }
                    
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-xl-4 col-md-12 col-lg-12">


            <div class="panel price  panel-color">
                <div class="bg-white text-center price-svg">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                        <path fill="orange" fill-opacity="1" d="M0,96L48,133.3C96,171,192,245,288,266.7C384,288,480,256,576,240C672,224,768,224,864,192C960,160,1056,96,1152,106.7C1248,117,1344,203,1392,245.3L1440,288L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"></path>
                    </svg>
                    <div class="price-title">Data Source</div>
                </div>
                <div class="panel-body text-center pt-0">
                    <p class="lead font-weight-semibold"><strong>
                        <a target="_blank" title="BCCEI" href="@Url.Content("https://bccei.co.za/")">
                            BCCEI
                        </a>
                        </strong></p>
                </div>
                <ul class="list-group list-group-flush text-center">
                    <li class="list-group-item">
                    <strong>Bargaining Council of Civil Engineering</strong>
                </li>
                    <li class="list-group-item">
                    <div class="row">
                        <div class="col-sm-12 border-end text-center">
                            <div class="description-block p-4">
                                <h5 class="description-header mb-1 font-weight-bold">Signatories</h5>
                            </div>
                            <div class="description-block text-center p-4">
                                <ul class="list-group">
                                    <li class="list-group-item">BCCEI</li>
                                    <li class="list-group-item">SAFEC</li>
                                    <li class="list-group-item">NUM</li>
                                    <li class="list-group-item">BCAWU</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    </li>
                </ul>
                <div class="panel-footer text-center border-end-0 border-start-0">
                    <a class="btn btn-lg btn-default btn-block" href="/Disclaimer">Disclaimer</a>
                </div>
            </div>

    </div>
</div>
<div class="row row-deck">
    <div class="col-xl-8 col-lg-7">
    <div class="card">
        <div class="card-header">
            <div class="card-title">Latest Wage rates By Occupation <span class="badge bg-primary rounded-pill">(Year: @latestYear)</span></div>
        </div>
        <div class="card-body grid-wrapper">
            <div class="table-responsive invoice-table-responsive">
                <table id="table-results" class="table card-table table-vcenter mb-0 border">
                    <thead>
                        <tr>
                            <th>Grade</th>
                            <th>Group</th>
                            <th>Occupation</th>
                            <th class="text-right">% increase</th>
                            <th class=text-right>Hourly Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var record in Model.Where(a => a.FinYear == latestYear).OrderBy(a => a.Ordinal).ThenBy(a => a.OccupationGroup).ThenBy(a => a.Occupation).ThenBy(a => a.Amount))
                        {
                            if(iteration !=record.Ordinal)
                            {
                                background = background == "bg-primary" ? "bg-success" : "bg-primary";
                                    }


                            <tr class="">
                                <td class="font-weight-semibold">
                                    @record.Ordinal
                                </td>
                                <td><strong>@record.OccupationGroup</strong></td>
                                <td><strong>@record.Occupation</strong></td>
                                <td class="@background text-right text-white"><strong>@record.PropertyValue %</strong></td>
                                <td class="@background text-right text-white">@record.Amount.ToRandValue()</td>
                            </tr>
                            iteration = record.Ordinal??0;
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    </div>
    <div class="col-xl-4 col-lg-5">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">About SWC Tracker</h3>
            </div>
            <div class="card-body">
               <div class="row">
                   <div class="col-md-12">
                        <p class="text-sm-start text-left padding-t-b-30 text-wrap">
                    We collect and present agreed salary rates agreed on a sector by sector basis. This information is benchmarked against annual inflations (CPI Index). This information is meant to help assist workers and their representative if their earnings are fair and not eroded by inflation.
                        </p>
                    </div>
               </div>
               <hr />
               <fieldset>
                   <legend>Target Audience</legend>
                   <p>
                       <ul class="list-group">
                            <li class="list-group-item">Collective Bragaining Councils</li>
                            <li class="list-group-item">Employer Associations</li>
                            <li class="list-group-item">Trade Unions(Worker representatives)</li>
                            <li class="list-group-item">Construction Sector Emmployees</li>
                            <li class="list-group-item">Labour Regulatory Authorities</li>
                        </ul>
                   </p>
               </fieldset>
                <fieldset>
                    <legend>Contact</legend>
                    <div class="media py-4 border-top mt-0">
                        <div class="media-body">
                            <div class="d-flex">
                                <div class="media-icon bg-light text-primary me-3 mt-1">
                                    <i class="fa fa-phone"></i>
                                </div>
                                <div>
                                    <label>Work</label> <span class="font-weight-semibold fs-14">+27 (78) 422 5989</span>
                                </div>
                            </div>
                            <div class="d-flex">
                                <div class="media-icon bg-light text-primary me-3 mt-1">
                                    <i class="fa fa-envelope"></i>
                                </div>
                                <div>
                                    <label>Other Account</label> <span class="font-weight-semibold fs-14">swctracker@algotec.co.za</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>

            <div class="card-footer text-center border-end-0 border-start-0">
                <a class="btn btn-lg btn-default btn-block" href="#">Buy me a coffee</a>
            </div>
        </div>
    </div>
</div>